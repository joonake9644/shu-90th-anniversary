<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase ì—°ê²° ì§„ë‹¨</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #1a1a1a;
      color: #00ff00;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 { color: #ffcc00; }
    h2 { color: #ff6600; border-bottom: 2px solid #333; padding-bottom: 10px; }
    .success { color: #00ff00; }
    .error { color: #ff0000; }
    .warning { color: #ffcc00; }
    .info { color: #00ccff; }
    pre {
      background: #000;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      border-left: 4px solid #00ff00;
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      background: #222;
      border-radius: 8px;
    }
    button {
      background: #00ff00;
      color: #000;
      border: none;
      padding: 10px 20px;
      margin: 10px 5px;
      cursor: pointer;
      font-weight: bold;
      border-radius: 4px;
    }
    button:hover { background: #00cc00; }
  </style>
</head>
<body>
  <h1>ğŸ” Firebase ì—°ê²° ì§„ë‹¨ ë„êµ¬</h1>
  <p class="warning">âš ï¸ ì´ í˜ì´ì§€ëŠ” í˜„ì¬ Firebase ì„¤ì •ì˜ ì‹¤ì œ ìƒíƒœë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.</p>

  <div class="test-section">
    <h2>1ï¸âƒ£ í™˜ê²½ ë³€ìˆ˜ ê²€ì¦</h2>
    <button onclick="checkEnvVars()">í™˜ê²½ ë³€ìˆ˜ í™•ì¸</button>
    <pre id="env-result">í´ë¦­í•˜ì—¬ í™•ì¸...</pre>
  </div>

  <div class="test-section">
    <h2>2ï¸âƒ£ Firebase ì´ˆê¸°í™” ìƒíƒœ</h2>
    <button onclick="checkFirebaseInit()">Firebase ì„¤ì • í™•ì¸</button>
    <pre id="firebase-result">í´ë¦­í•˜ì—¬ í™•ì¸...</pre>
  </div>

  <div class="test-section">
    <h2>3ï¸âƒ£ Firestore ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
    <button onclick="testFirestoreRead()">Events ë°ì´í„° ì½ê¸°</button>
    <button onclick="testFirestoreWrite()">í…ŒìŠ¤íŠ¸ ì“°ê¸°</button>
    <pre id="firestore-result">í´ë¦­í•˜ì—¬ í™•ì¸...</pre>
  </div>

  <div class="test-section">
    <h2>4ï¸âƒ£ Storage ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
    <button onclick="testStorage()">Storage í™•ì¸</button>
    <pre id="storage-result">í´ë¦­í•˜ì—¬ í™•ì¸...</pre>
  </div>

  <div class="test-section">
    <h2>5ï¸âƒ£ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ë¶„ì„</h2>
    <p class="info">ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì˜ Network íƒ­ì„ ì—´ê³  ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.</p>
    <p class="info">firestore.googleapis.comìœ¼ë¡œ ê°€ëŠ” ìš”ì²­ì˜ URLê³¼ Responseë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, getDocs, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { getStorage, ref, listAll } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

    // í™˜ê²½ ë³€ìˆ˜ ì½ê¸° (Next.js ë¹Œë“œì—ì„œ ì£¼ì…ë¨)
    const firebaseConfig = {
      apiKey: "AIzaSyAFL2UzS-p_NAt3iGpI2V__S8g-B_72kZs",
      authDomain: "shu-90th-anniversary.firebaseapp.com",
      projectId: "shu-90th-anniversary",
      storageBucket: "shu-90th-anniversary.firebasestorage.app",
      messagingSenderId: "875713156990",
      appId: "1:875713156990:web:b8ad8badb7e2dbebedc52f",
      measurementId: "G-YTHEF7JMZB"
    };

    let app, db, storage;

    try {
      app = initializeApp(firebaseConfig);
      db = getFirestore(app);
      storage = getStorage(app);
      console.log('âœ… Firebase initialized successfully');
    } catch (error) {
      console.error('âŒ Firebase initialization failed:', error);
    }

    window.checkEnvVars = function() {
      const result = document.getElementById('env-result');
      result.innerHTML = `
<span class="info">â•â•â•â•â•â•â• Firebase Config (í•˜ë“œì½”ë”©ë¨) â•â•â•â•â•â•â•</span>
API Key: ${firebaseConfig.apiKey}
Auth Domain: ${firebaseConfig.authDomain}
Project ID: <span class="success">${firebaseConfig.projectId}</span>
Storage Bucket: <span class="success">${firebaseConfig.storageBucket}</span>
Messaging Sender ID: ${firebaseConfig.messagingSenderId}
App ID: ${firebaseConfig.appId}

<span class="warning">âš ï¸ ì¤‘ìš”: ì´ ì„¤ì •ì´ Firebase Consoleê³¼ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”!</span>
<span class="info">Firebase Console: https://console.firebase.google.com/project/${firebaseConfig.projectId}</span>
      `.trim();
    };

    window.checkFirebaseInit = function() {
      const result = document.getElementById('firebase-result');

      if (!app) {
        result.innerHTML = '<span class="error">âŒ Firebase ì•±ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!</span>';
        return;
      }

      result.innerHTML = `
<span class="success">âœ… Firebase App ì´ˆê¸°í™” ì™„ë£Œ</span>

App Name: ${app.name}
Options:
${JSON.stringify(app.options, null, 2)}

<span class="info">Firestore Instance:</span> ${db ? 'âœ… Connected' : 'âŒ Not initialized'}
<span class="info">Storage Instance:</span> ${storage ? 'âœ… Connected' : 'âŒ Not initialized'}

<span class="warning">âš ï¸ Emulator ì²´í¬:</span>
- Firestore Emulator: ${db && db._settings?.host?.includes('localhost') ? 'ğŸ”´ ì‚¬ìš© ì¤‘ (ë¡œì»¬)' : 'âœ… ì‚¬ìš© ì•ˆ í•¨ (í”„ë¡œë•ì…˜)'}
- Storage Emulator: ${storage && storage._url?.includes('localhost') ? 'ğŸ”´ ì‚¬ìš© ì¤‘ (ë¡œì»¬)' : 'âœ… ì‚¬ìš© ì•ˆ í•¨ (í”„ë¡œë•ì…˜)'}
      `.trim();
    };

    window.testFirestoreRead = async function() {
      const result = document.getElementById('firestore-result');
      result.innerHTML = '<span class="info">ğŸ”„ Events ì»¬ë ‰ì…˜ ì½ëŠ” ì¤‘...</span>';

      try {
        const startTime = performance.now();
        const eventsRef = collection(db, 'events');
        const snapshot = await getDocs(eventsRef);
        const endTime = performance.now();

        const events = [];
        snapshot.forEach(doc => {
          events.push({
            id: doc.id,
            title: doc.data().title,
            category: doc.data().category,
            location: doc.data().location
          });
        });

        result.innerHTML = `
<span class="success">âœ… Firestore ì½ê¸° ì„±ê³µ!</span>

ì‘ë‹µ ì‹œê°„: ${(endTime - startTime).toFixed(2)}ms
ë¬¸ì„œ ê°œìˆ˜: <span class="success">${snapshot.size}ê°œ</span>

ìƒ˜í”Œ ë°ì´í„° (ì²˜ìŒ 3ê°œ):
${JSON.stringify(events.slice(0, 3), null, 2)}

<span class="info">ğŸ“ ì‹¤ì œ ì—”ë“œí¬ì¸íŠ¸:</span>
https://firestore.googleapis.com/v1/projects/${firebaseConfig.projectId}/databases/(default)/documents/events

<span class="warning">âš ï¸ Network íƒ­ì—ì„œ ìœ„ URLë¡œ ìš”ì²­ì´ ê°”ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”!</span>
        `.trim();
      } catch (error) {
        result.innerHTML = `
<span class="error">âŒ Firestore ì½ê¸° ì‹¤íŒ¨!</span>

ì—ëŸ¬ íƒ€ì…: ${error.name}
ì—ëŸ¬ ë©”ì‹œì§€: ${error.message}
ì—ëŸ¬ ì½”ë“œ: ${error.code || 'N/A'}

<span class="warning">ê°€ëŠ¥í•œ ì›ì¸:</span>
1. ë³´ì•ˆ ê·œì¹™ì´ ì½ê¸°ë¥¼ ì°¨ë‹¨í•˜ê³  ìˆìŒ
2. ì»¬ë ‰ì…˜ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
3. ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œ
4. Firebase í”„ë¡œì íŠ¸ IDê°€ ì˜ëª»ë¨

<span class="info">ì „ì²´ ì—ëŸ¬ ê°ì²´:</span>
${JSON.stringify(error, null, 2)}
        `.trim();
      }
    };

    window.testFirestoreWrite = async function() {
      const result = document.getElementById('firestore-result');
      result.innerHTML = '<span class="info">ğŸ”„ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì“°ëŠ” ì¤‘...</span>';

      try {
        const testDoc = {
          type: 'diagnostic_test',
          timestamp: serverTimestamp(),
          message: 'ì§„ë‹¨ í…ŒìŠ¤íŠ¸',
          browser: navigator.userAgent,
          url: window.location.href
        };

        const docRef = await addDoc(collection(db, 'test-collection'), testDoc);

        result.innerHTML = `
<span class="success">âœ… Firestore ì“°ê¸° ì„±ê³µ!</span>

ìƒì„±ëœ ë¬¸ì„œ ID: <span class="success">${docRef.id}</span>
ì»¬ë ‰ì…˜ ê²½ë¡œ: test-collection

<span class="info">Firebase Consoleì—ì„œ í™•ì¸:</span>
https://console.firebase.google.com/project/${firebaseConfig.projectId}/firestore/data/test-collection/${docRef.id}

<span class="warning">âš ï¸ ìœ„ ë§í¬ë¥¼ í´ë¦­í•´ì„œ ì‹¤ì œë¡œ Firebase Consoleì— ë°ì´í„°ê°€ ë³´ì´ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”!</span>
        `.trim();
      } catch (error) {
        result.innerHTML = `
<span class="error">âŒ Firestore ì“°ê¸° ì‹¤íŒ¨!</span>

ì—ëŸ¬ ì½”ë“œ: <span class="error">${error.code || 'N/A'}</span>
ì—ëŸ¬ ë©”ì‹œì§€: ${error.message}

<span class="warning">ê°€ëŠ¥í•œ ì›ì¸:</span>
1. <span class="error">ë³´ì•ˆ ê·œì¹™ì´ ì“°ê¸°ë¥¼ ì°¨ë‹¨</span> (ê°€ì¥ ê°€ëŠ¥ì„± ë†’ìŒ)
2. ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì
3. ê¶Œí•œ ë¶€ì¡±
4. ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ

ì „ì²´ ì—ëŸ¬:
${JSON.stringify(error, null, 2)}
        `.trim();
      }
    };

    window.testStorage = async function() {
      const result = document.getElementById('storage-result');
      result.innerHTML = '<span class="info">ğŸ”„ Storage í™•ì¸ ì¤‘...</span>';

      try {
        const storageRef = ref(storage, '/');
        const listResult = await listAll(storageRef);

        result.innerHTML = `
<span class="success">âœ… Storage ì—°ê²° ì„±ê³µ!</span>

Storage Bucket: <span class="success">${firebaseConfig.storageBucket}</span>
ë£¨íŠ¸ í´ë” ê°œìˆ˜: ${listResult.prefixes.length}
ë£¨íŠ¸ íŒŒì¼ ê°œìˆ˜: ${listResult.items.length}

í´ë” ëª©ë¡:
${listResult.prefixes.map(p => `  - ${p.fullPath}`).join('\n') || '  (í´ë” ì—†ìŒ)'}

<span class="info">Firebase Storage Console:</span>
https://console.firebase.google.com/project/${firebaseConfig.projectId}/storage

<span class="warning">âš ï¸ ìœ„ Consoleì—ì„œ ì‹¤ì œ ë²„í‚·ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”!</span>
        `.trim();
      } catch (error) {
        result.innerHTML = `
<span class="error">âŒ Storage ì ‘ê·¼ ì‹¤íŒ¨!</span>

ì—ëŸ¬ ì½”ë“œ: ${error.code || 'N/A'}
ì—ëŸ¬ ë©”ì‹œì§€: ${error.message}

<span class="warning">ê°€ëŠ¥í•œ ì›ì¸:</span>
1. Storage ë³´ì•ˆ ê·œì¹™ì´ ì½ê¸°ë¥¼ ì°¨ë‹¨
2. Storage Bucketì´ ì˜ëª» ì„¤ì •ë¨
3. ê¶Œí•œ ë¶€ì¡±

ì „ì²´ ì—ëŸ¬:
${JSON.stringify(error, null, 2)}
        `.trim();
      }
    };

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
    window.addEventListener('load', () => {
      console.log('%cğŸ” Firebase ì§„ë‹¨ ë„êµ¬ ë¡œë“œë¨', 'color: #00ff00; font-size: 20px; font-weight: bold;');
      console.log('í˜ì´ì§€ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì§„ë‹¨ì„ ì‹œì‘í•˜ì„¸ìš”.');
      console.log('ë˜ëŠ” ì½˜ì†”ì—ì„œ ë‹¤ìŒ í•¨ìˆ˜ë¥¼ ì§ì ‘ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:');
      console.log('  - checkEnvVars()');
      console.log('  - checkFirebaseInit()');
      console.log('  - testFirestoreRead()');
      console.log('  - testFirestoreWrite()');
      console.log('  - testStorage()');
    });
  </script>
</body>
</html>
